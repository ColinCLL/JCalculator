<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<script src = "./JCalculator.js"></script>
	<script>
  var table = [
    {time:"10月1日", inPerson:20, outPerson:1000, region: "广州",fly:12},
    {time:"10月1日", inPerson:13, outPerson:900, region: "深圳",fly:2},
    {time:"10月2日", inPerson:15, outPerson:900, region: "广州",fly:null},
    {time:"10月2日", inPerson:15, outPerson:1000, region: "深圳",fly:0},
    {time:"10月3日", inPerson:15, outPerson:100, region: "广州"},
    {time:"10月3日", inPerson:15, outPerson:100, region: "深圳"},
    {time:"10月4日", inPerson:90, outPerson:60, region: "广州"},
    {time:"10月4日", inPerson:70, outPerson:50, region: "深圳"},
    {time:"10月5日", inPerson:500, outPerson:39, region: "广州"},
    {time:"10月5日", inPerson:350, outPerson:30, region: "深圳"},
    {time:"10月6日", inPerson:900, outPerson:15, region: "广州"},
    {time:"10月6日", inPerson:1000, outPerson:15, region: "深圳"},
    {time:"10月7日", inPerson:900, outPerson:10, region: "广州"},
    {time:"10月7日", inPerson:1200, outPerson:7, region: "深圳"}
  ]

  var data1 = jc.sql({
    select: {
      sum: ["inPerson","outPerson","fly"],
      avg: ["inPerson","outPerson","fly"],
      count: "fly"
    },
    from: table
  })
  console.log("国庆广深总人口流动分析");
  console.log(data1);

  var sum1 = jc.sql({
    select: {
      sum: "inPerson"
    },
    from: table
  })
  console.log("sum1");
  console.log(sum1);

  var sum2 = jc.sql({
    select: {
      sum: ["inPerson","outPerson"]
    },
    from: table
  })
  console.log("sum2");
  console.log(sum2);
  // {sum_inPerson: 5103, sum_outPerson: 4226}

  var sum3 = jc.sql({
    select: {
      sum: {
        "流入人口总和":function  (row) {
          return row.inPerson
        },
        "流出人口总和":"outPerson",
        流动人口总和:function (row) {
          return row.inPerson + row.outPerson;
        }
      }
    },
    from: table
  })
  console.log("sum3");
  console.log(sum3);
  // 输出：{流入人口总和: 5103, 流出人口总和: 4226, 流动人口总和: 9329}

  var count = jc.sql({
    select: {
      count: "*"
    },
    from: table,
    where:{time:"10月1日"}
  })
  console.log("count");
  console.log(JSON.stringify(count));
  //输出：[{avg_inPerson: 364.5, avg_outPerson: 301.85714285714283, avg_fly: 4.666666666666667}]

    var count = jc.sql({
      select: {
        count: {
          all:"*"
        }
      },
      from: table
    })
    console.log("count1");
    console.log(JSON.stringify(count));

  // max: {obj}。
  var max = jc.sql({
    select: {
      max: ["inPerson"]
    },
    from: table,
    where: { time: "10月1日" }
  })
  console.log("max");
  console.log(max);

  // where: {obj}。
  var where1 = jc.sql({
    select: {
      count: ["inPerson","outPerson","fly"]
    },
    from: table,
    where:{time:"10月1日"}
  })
  console.log("where1");
  console.log(where1);
  // 输出：2

  // where: function(row){ return true}。
  var where2 = jc.sql({
    select: {
      sum: "inPerson"
    },
    from: table,
    where: function (row) {
      return row.time == "10月1日" || row.time == "10月7日"
    }
  })
  console.log("where2");
  console.log(where2);

  // groupBy: {obj};
  var groupBy1 = jc.sql({
    select: {
      count: ["inPerson","outPerson","fly","*"]
    },
    from: table,
    groupBy:"time"
  })
  console.log("groupBy1");
  console.log(JSON.stringify(groupBy1));
  // 输出： [2]

  // groupBy: function (row) { return true};
  var groupBy2 = jc.sql({
    select: {
      sum: "inPerson"
    },
    from: table,
    groupBy: function (row) {
      return row.time
    }
  })
  console.log("groupBy2");
  console.log(JSON.stringify(groupBy2));
  //输出：[{sum_inPerson: 2133}]

  // groupBy: ["string", function (row) {}];
  var groupBy3 = jc.sql({
    select: {
      sum: "inPerson"
    },
    from: table,
    groupBy: ["fly"]
  })
  console.log("groupBy3");
  console.log(JSON.stringify(groupBy3));
  //输出：[{sum_inPerson: 2133}]



  var data2 = jc.sql({
    select: {
      col: ["time","region"],
      sum: ["inPerson","outPerson"],
      avg: ["inPerson","outPerson"]
    },
    from: table,
    where:{region:"广州"},
    groupBy:["time","region"]
  })
  console.log("广州总人口流动分析");
  console.log(data2);

  var ttt = jc.keyArray(data2,["time","region"]);
  console.log(ttt)

  var data3 = jc.sql({
    select: {
      col: {
        "城市":"region"
      },
      sum: {
        "流入人口总和": "inPerson",
        "流出人口总和": "outPerson",
        "流入流出人口总和": function(row){
          return row.inPerson + row.outPerson
        }
      },
      avg: {
        "流入人口平均数":"inPerson",
        "流出人口平均数":"outPerson",
        "流入流出人口平均数":function(row){
          return row.inPerson + row.outPerson
        }
      }
    },
    from: table,
    groupBy:"region"
  })
  console.log("城市总人口流动分析");
  console.log(data3)


  var data4 = jc.sql({
    select: {
      col:{
        "时间":"time"
      },
      sum: {
        "流入人口总和":"inPerson",
        "流出人口总和":"outPerson",
        "流入流出人口总和":function(row){
          return row.inPerson + row.outPerson
        }
      },
      avg: {
        "流入人口平均数":"inPerson",
        "流出人口平均数":"outPerson",
        "流入流出人口平均数":function(row){
          return row.inPerson + row.outPerson
        }
      }
    },
    from: table,
    groupBy: "time",
    having: {"sum_inPerson+outPerson":">1000"},
    orderBy:function (left, right) {
      return left.流入人口平均数 < right.流入人口平均数;
    },
    limit:[0,2]
  })
  console.log("广深总人口流动大于1000Wd的日期分析");
  console.log(JSON.stringify(data4))
  var arr = [1,1,2,2,34,5]
  var obj = [{test:113,text:"332"},{test:113 ,text:"332"},{test:1134, text:"332"},{test:1134,text:"332"}];
  var aaa = jc.unique(obj);
  console.log(aaa);



  var time = [
  { OTHER: 1, IN: 10, OUT: 10 },
  { OTHER: 2, IN: 20, OUT: 20 },
  { OTHER: 3, IN: 30, OUT: 30 },
  { OTHER:7, IN:20, OUT:40 },
  { OTHER:8, IN:30, OUT:50 },
  { OTHER:11, IN:40, OUT:60 }
  ];
  var set = {
    key: "OTHER",
    start: 0, 
    end: 12,
    space: 1,
    zeroFill: ["IN", "OUT"]
  }
  var fix = jc.spaceFix(time, set);
  console.log(fix);

  var keybreak = jc.keybreak(time, {
    break: ["IN", "OUT"],
    key: "type",
    value: "value",
    retain:["OTHER"]
  })
  
	</script>
</body>
</html>