!function(){var n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,r=(n.jc,Array.prototype),t=Object.prototype;r.push;slice=r.slice,toString=t.toString,hasOwnProperty=t.hasOwnProperty;var e=Array.isArray,i=Object.keys,f=Object.values?Object.values:function(r){return i(r).map(function(n){return r[n]})},s=(Object.create,function(n){return n instanceof s?n:this instanceof s?void(this._wrapped=n):new s(n)});function a(n,r,t){return s.isNoVal(n)||s.isNoVal(r)?s.isNoVal(n)?r:n:(t="max"==t?r<n:n<r)?n:r}function l(r,n){var t={};return s.isArray(n)?s.map(n,function(n){t[r+n]=n}):s.isObject(n)?s.forIn(n,function(n,r){t[n]=r}):s.isString(n)&&(t[r+n]=n),t}function p(n,r){var i={},o=n.length,u={};return s.map(n,function(e){s.isObjEmpty(r.colObj)||s.forIn(r.colObj,function(n,r){var t=s.isFunction(r)?r(e):e[r];i[n]=t}),s.isObjEmpty(r.sumObj)||s.forIn(r.sumObj,function(n,r){var t=s.isFunction(r)?r(e):e[r];i[n]?i[n]+=t||0:i[n]=t||0}),s.isObjEmpty(r.avgObj)||s.forIn(r.avgObj,function(n,r){u[n]||(u[n]=0);var t=s.isFunction(r)?r(e):e[r];i[n]?i[n]+=t||0:i[n]=t||0,(t||0==t)&&u[n]++}),s.isObjEmpty(r.maxObj)||s.forIn(r.maxObj,function(n,r){var t=s.isFunction(r)?r(e):e[r];i[n]=a(i[n],t,"max")}),s.isObjEmpty(r.minObj)||s.forIn(r.minObj,function(n,r){var t=s.isFunction(r)?r(e):e[r];i[n]=a(i[n],t,"min")}),s.isObjEmpty(r.countObj)||s.forIn(r.countObj,function(n,r){var t=s.isFunction(r)?r(e):e[r];switch(s.isUndefined(i[n])&&(i[n]=0),n){case"*"==r?n:"count_*":i[n]=o;break;default:s.isUndefined(t)||null==t||i[n]++}})}),s.forIn(r.avgObj,function(n,r){i[n]=i[n]/u[n]}),i}function c(n,r){if(!r)return n;if(s.isObject(r)&&!s.isFunction(r)){var u=i(r),a=f(r);n.sort(function(n,r){for(var t,e,i=u.length,o=0;o<i&&(t=u[o],e=a[o],n[t]===r[t]);o++);if(n[t]!==r[t]){if(n[t]>r[t]||void 0===r[t])return"desc"===e||"DESC"===e?-1:1;if(n[t]<r[t]||void 0===n[t])return"desc"===e||"DESC"===e?1:-1}return"desc"===e||"DESC"===e?r[t]-n[t]:n[t]-r[t]})}else s.isFunction(r)&&n.sort(r);return n}function m(n,r){if(!r&&0!=r)return n;var t=[],e=n.length,i=0;if(s.isNumber(r))e=e<r?e:r;else if(s.isArray(r)){if(r[0]>e)return[];r[0]<e&&(i=r[0]),e=r[0]+r[1]<e?r[0]+r[1]:e}for(;i<e;i++)t.push(n[i]);return t}"undefined"==typeof exports||exports.nodeType?n.jc=s:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=s),exports.jc=s),s.VERSION="1.1.0",s.map=function(n,r){return s.isArray(n)?n.map(r):[]},s.forIn=function(n,r){if(!s.isObject(n))return{};var t=0;for(var e in n)r(e,n[e],t),t++},s.filter=function(n,r){return s.isArray(n)?n.filter(r):[]},s.where=function(n,t){var r;if(s.isFunction(t))r=s.filter(n,t);else{if(!s.isObject(t))return[];r=s.filter(n,function(r){return i(t).every(function(n){return t[n]===r[n]})})}return r},s.limit=function(n,r){return m(n,r)},s.order=s.orderBy=function(n,r){return c(n,r)},s.tree=function(n,t){var r;t.children||(t.children="children"),s.isString(t.retain)?r=[t.retain,t.id,t.parent]:s.isArray(t.retain)?((r=t.retain).push(t.id),r.push(t.parent)):s.isObject(t.retain)?((r=t.retain)[t.id]=t.id,r[t.parent]=t.parent):n=s.extend(!0,[],n),r&&(n=s.sql({select:{col:r},from:n}));var e={},i=s.groupBy(n,function(n){return n[t.id]==t.root&&(e=n),n[t.parent]});return s.map(n,function(n){var r=n[t.id];i[r]&&(n[t.children]=i[r])}),s.isObjEmpty(e)&&(e[t.children]=i[t.root]),e},s.extend=function(){var n,r,t,e,i,o,u=arguments[0]||{},a=1,c=arguments.length,f=!1;for("boolean"==typeof u&&(f=u,u=arguments[1]||{},a++),"object"==typeof u||s.isFunction(u)||(u={}),c===a&&(u=this,--a);a<c;a++)if(null!=(n=arguments[a]))for(r in n)t=u[r],u!==(e=n[r])&&(f&&e&&(s.isObject(e)||(i=s.isArray(e)))?(o=i?(i=!1,t&&s.isArray(t)?t:[]):t&&s.isObject(t)?t:{},u[r]=s.extend(f,o,e)):void 0!==e&&(u[r]=e));return u},s.unique=function(n){if(!n||0==n.length)return n;var t={},e=[];s.map(n,function(n){var r=JSON.stringify(n);t[r]=n});return s.forIn(t,function(n,r){e.push(r)}),e},s.spaceFix=function(n,r){if(!n||0==n.length)return n;var t=[];0<n[0][r.key]-r.start&&((f={})[r.key]=r.start,s.map(r.zeroFill,function(n){f[n]=0}),n.unshift(f));n[n.length-1][r.key]<r.end&&((f={})[r.key]=r.end,s.map(r.zeroFill,function(n){f[n]=0}),n.push(f));for(var e=1,i=n.length;e<i&&!(1e4<e);e++){var o=n[e][r.key]-n[e-1][r.key];if(o<=r.space)t.push(n[e]);else{for(var u=r.space,a=0,c=o/r.space;a<c-1&&!(1e4<a);a++){var f;(f={})[r.key]=parseInt(n[e-1][r.key])+parseInt(u),s.map(r.zeroFill,function(n){f[n]=0}),t.push(f),u+=r.space}t.push(n[e])}}return t.unshift(n[0]),t},s.keyArray=function(n,r){if(!n||0==n.length)return n;s.isString(r)&&(r=[r]);var e={};return s.map(n,function(t,n){s.map(r,function(n,r){e[n]||(e[n]=[]),e[n].push(t[n])})}),e},s.keyBreak=function(n,e){if(!n||0==n.length)return n;var i=[],o=e.key,u=e.value;return s.map(n,function(t){s.map(e.break,function(n){var r={};r[o]=n,r[u]=t[n],s.map(e.retain,function(n){r[n]=t[n]}),i.push(r)})}),i},s.index=function(n,r){if(!n||0==n.length)return n;var t={};return s.map(n,function(n){console.log(n.key),t[n[r]]=n}),t},s.max=function(n,e){if(!n||0==n.length)return n;var i;if(s.isString(e)){var r=e;e=function(n){return n[r]}}else s.isUndefined(e)&&(e=function(n){return n});return s.map(n,function(n){var r=i?e(i):i,t=n?e(n):n;i=s.isNoVal(r)||s.isNoVal(t)?s.isNoVal(r)?n:i:t<r?i:n}),i},s.min=function(n,e){if(!n||0==n.length)return n;var i;if(s.isString(e)){var r=e;e=function(n){return n[r]}}else s.isUndefined(e)&&(e=function(n){return n});return s.map(n,function(n){var r=i?e(i):i,t=n?e(n):n;i=s.isNoVal(r)||s.isNoVal(t)?s.isNoVal(r)?n:i:r<t?i:n}),i},s.group=s.groupBy=function(n,r){if(!n||0==n.length)return n;var i={};return s.map(n,function(t,n){var e=[];s.isArray(r)?s.map(r,function(n,r){s.isFunction(n)?e.push(n(t)):e.push(t[n])}):s.isString(r)?e.push(t[r]):s.isFunction(r)&&(e=r(t,n)),i[e]||(i[e]=[]),i[e].push(t)}),i},s.sql=function(n){if(function(n){if(!n.from)throw new Error("From is not defined","Error from");if(!n.select)throw new Error("Select is not defined","Error select");!function(n){var r=n.select,t=n.groupBy;if(!(r.sum||r.avg||r.count||r.max||r.min))return;if(r.col&&!n.groupBy)return;var e=l("",r.col);e=f(e);var i=[],o=!1;s.isArray(t)?s.map(t,function(n,r){i.push(n)}):s.isString(t)?i.push(t):s.isFunction(t)&&(i=[t]);for(var u=0,a=e.length;u<a;u++){for(var c=0;c<a;c++){if(e[u]==i[c]){o=!0;break}if(s.isObject(e[u])&&s.isObject(i[c])&&String(e[u])===String(i[c])){o=!0;break}}if(!o)throw new Error("groupBy should contain select.col","Error groupBy");o=!1}}(n)}(n),0==n.from.length||!s.isArray(n.from))return[];var r,t,e,i,o,u,a=n.from;return t=a,r=(e=n.where)?s.where(t,e):t,i=r,o=n,s.forIn(o.select,function(n,r){u=!("col"==n)||u}),m(c(function(n,r){if(!r)throw new Error("Select is not defined","Error select");var o=[],u={};r.col&&(u.colObj=l("",r.col));r.sum&&(u.sumObj=l("sum_",r.sum));r.avg&&(u.avgObj=l("avg_",r.avg));r.max&&(u.maxObj=l("max_",r.max));r.min&&(u.minObj=l("min_",r.min));r.count&&(u.countObj=l("count_",r.count));s.isArray(n)?s.map(n,function(n,r){var t=p([n],u);o.push(t)}):s.forIn(n,function(n,r,t,e){var i=p(r,u);o.push(i)});return o}(function(n,a){if(!a)return n;var c={sumObj:{},avgObj:{},maxObj:{},minObj:{},countObj:{}},f={};return s.forIn(a,function(n,r){var t=n.split("_"),e=t.shift(),i=t.join("_");switch(i=i.replace(/[1-9a-zA-z_\$\@]+/g,function(n){return"row['"+n+"']"}),e){case"sum":c.sumObj[n]=function(n){return new Function("row","return "+i)(n)};break;case"avg":c.avgObj[n]=function(n){return new Function("row","return "+i)(n)};break;case"max":c.maxObj[n]=function(n){return new Function("row","return "+i)(n)};break;case"min":c.minObj[n]=function(n){return new Function("row","return "+i)(n)};break;case"count":c.countObj[n]=function(n){return new Function("row","return "+i)(n)}}}),s.forIn(n,function(n,r,t,e){var i,o=p(r,c);for(var u in a)if(foo=new Function("return "+o[u]+a[u]),!(i=foo()))break;i&&(f[n]=r)}),f}(o.groupBy||u?o.groupBy||o.select.col?s.group(i,o.groupBy):{table:i}:i,n.having),n.select),n.orderBy),n.limit)},s.isObjEmpty=function(n){for(var r in n)return!1;return!0},s.isNoVal=function(n){return s.isUndefined(n)||null==n||n!=n},s.isArray=e||function(n){return"[object Array]"===toString.call(n)},s.isObject=function(n){return"object"===typeof n&&!s.isArray(n)&&!!n},s.map(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(r){s["is"+r]=function(n){return{}.toString.call(n)==="[object "+r+"]"}}),s.isUndefined=function(n){return void 0===n},"function"==typeof define&&define.amd&&define("jc",[],function(){return s})}();